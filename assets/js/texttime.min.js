// domWindowt.js
!function(o){o.fn.closeDOMWindow=function(e){e||(e={});var n=function(n){if(e.anchoredClassName){var i=o("."+e.anchoredClassName);i.fadeOut("fast",function(){o.fn.draggable?i.draggable("destory").trigger("unload").remove():i.trigger("unload").remove()}),e.functionCallOnClose&&e.functionCallAfterClose()}else{var t=o("#DOMWindowOverlay"),d=o("#DOMWindow");t.fadeOut("fast",function(){t.trigger("unload").unbind().remove()}),d.fadeOut("fast",function(){o.fn.draggable?d.draggable("destroy").trigger("unload").remove():d.trigger("unload").remove()}),o(window).unbind("scroll.DOMWindow"),o(window).unbind("resize.DOMWindow"),o.fn.openDOMWindow.isIE6&&o("#DOMWindowIE6FixIframe").remove(),e.functionCallOnClose&&e.functionCallAfterClose()}};return e.eventType?this.each(function(i){o(this).bind(e.eventType,function(){return n(this),!1})}):void n()},o.closeDOMWindow=function(e){o.fn.closeDOMWindow(e)},o.fn.openDOMWindow=function(e){var n=o.fn.openDOMWindow;n.defaultsSettings={anchoredClassName:"",anchoredSelector:"",borderColor:"#C0BBB5",borderSize:"4",draggable:0,eventType:null,fixedWindowY:100,functionCallOnOpen:null,functionCallOnClose:null,loader:0,loaderHeight:0,loaderImagePath:"",loaderWidth:0,modal:0,overlay:1,overlayColor:"#000",overlayOpacity:"85",positionLeft:0,positionTop:0,positionType:"centered",windowBGColor:"#FFFFFF",windowBGImage:null,windowHTTPType:"get",windowPadding:10,windowSource:"inline",windowSourceID:"",windowSourceURL:"",windowSourceAttrURL:"href"};var i=o.extend({},o.fn.openDOMWindow.defaultsSettings,e||{});n.viewPortHeight=function(){return self.innerHeight||document.documentElement.clientHeight||document.body.clientHeight},n.viewPortWidth=function(){return self.innerWidth||document.documentElement.clientWidth||document.body.clientWidth},n.scrollOffsetHeight=function(){return self.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop},n.scrollOffsetWidth=function(){return self.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft},n.isIE6="undefined"==typeof document.body.style.maxHeight;var t=function(){var e=o("#DOMWindowOverlay");if(n.isIE6){var i=document.documentElement.offsetHeight+document.documentElement.scrollTop-4,t=document.documentElement.offsetWidth-21;e.css({height:i+"px",width:t+"px"})}else e.css({height:"100%",width:"100%",position:"fixed"})},d=function(){var e=document.documentElement.offsetHeight+document.documentElement.scrollTop-4,n=document.documentElement.offsetWidth-21;o("#DOMWindowIE6FixIframe").css({height:e+"px",width:n+"px"})},a=function(){var e=o("#DOMWindow");i.height+50>n.viewPortHeight()?e.css("left",Math.round(n.viewPortWidth()/2)+n.scrollOffsetWidth()-Math.round(e.outerWidth()/2)):(e.css("left",Math.round(n.viewPortWidth()/2)+n.scrollOffsetWidth()-Math.round(e.outerWidth()/2)),e.css("top",Math.round(n.viewPortHeight()/2)+n.scrollOffsetHeight()-Math.round(e.outerHeight()/2)))},r=function(){var e=o("#DOMWindowLoader");n.isIE6?(e.css({left:Math.round(n.viewPortWidth()/2)+n.scrollOffsetWidth()-Math.round(e.innerWidth()/2),position:"absolute"}),e.css({top:Math.round(n.viewPortHeight()/2)+n.scrollOffsetHeight()-Math.round(e.innerHeight()/2),position:"absolute"})):e.css({left:"50%",top:"50%",position:"fixed"})},l=function(){var e=o("#DOMWindow");e.css("left",i.positionLeft+n.scrollOffsetWidth()),e.css("top",+i.positionTop+n.scrollOffsetHeight())},c=function(e){arguments[0]?(o("."+e+" #DOMWindowLoader").remove(),o("."+e+" #DOMWindowContent").fadeIn("fast",function(){i.functionCallOnOpen&&i.functionCallOnOpen()}),o("."+e+".closeDOMWindow").click(function(){return o.closeDOMWindow(),!1})):(o("#DOMWindowLoader").remove(),o("#DOMWindow").fadeIn("fast",function(){i.functionCallOnOpen&&i.functionCallOnOpen()}),o("#DOMWindow .closeDOMWindow").click(function(){return o.closeDOMWindow(),!1}))},s=function(o){var e={};return o.replace(/b([^&=]*)=([^&=]*)b/g,function(o,n,i){"undefined"!=typeof e[n]?e[n]+=","+i:e[n]=i}),e},u=function(e){i.windowSourceID=o(e).attr("href")||i.windowSourceID,i.windowSourceURL=o(e).attr(i.windowSourceAttrURL)||i.windowSourceURL,i.windowBGImage=i.windowBGImage?"background-image:url("+i.windowBGImage+")":"";var u,f;if("anchored"==i.positionType){var w=o(i.anchoredSelector).position(),p=w.left+i.positionLeft,h=w.top+i.positionTop;switch(o("body").append('<div class="'+i.anchoredClassName+'" style="'+i.windowBGImage+";background-repeat:no-repeat;padding:"+i.windowPadding+"px;overflow:auto;position:absolute;top:"+h+"px;left:"+p+"px;height:"+i.height+"px;width:"+i.width+"px;background-color:"+i.windowBGColor+";border:"+i.borderSize+"px solid "+i.borderColor+';z-index:10001"><div id="DOMWindowContent" style="display:none"></div></div>'),i.loader&&""!==i.loaderImagePath&&o("."+i.anchoredClassName).append('<div id="DOMWindowLoader" style="width:'+i.loaderWidth+"px;height:"+i.loaderHeight+'px;"><img src="'+i.loaderImagePath+'" /></div>'),o.fn.draggable&&i.draggable&&o("."+i.anchoredClassName).draggable({cursor:"move"}),i.windowSource){case"inline":o("."+i.anchoredClassName+" #DOMWindowContent").append(o(i.windowSourceID).children()),o("."+i.anchoredClassName).unload(function(){o("."+i.windowSourceID).append(o("."+i.anchoredClassName+" #DOMWindowContent").children())}),c(i.anchoredClassName);break;case"iframe":o("."+i.anchoredClassName+" #DOMWindowContent").append('<iframe frameborder="0" hspace="0" wspace="0" src="'+i.windowSourceURL+'" name="DOMWindowIframe'+Math.round(1e3*Math.random())+'" style="width:100%;height:100%;border:none;background-color:#FEA45A;" class="'+i.anchoredClassName+'Iframe" ></iframe>'),o("."+i.anchoredClassName+"Iframe").load(c(i.anchoredClassName));break;case"ajax":"post"==i.windowHTTPType?(-1!==i.windowSourceURL.indexOf("?")?(u=i.windowSourceURL.substr(0,i.windowSourceURL.indexOf("?")),f=s(i.windowSourceURL)):(u=i.windowSourceURL,f={}),o("."+i.anchoredClassName+" #DOMWindowContent").load(u,f,function(){c(i.anchoredClassName)})):(-1==i.windowSourceURL.indexOf("?")&&(i.windowSourceURL+="?"),o("."+i.anchoredClassName+" #DOMWindowContent").load(i.windowSourceURL+"&random="+(new Date).getTime(),function(){c(i.anchoredClassName)}))}}else{if(i.overlay){o("body").append('<div id="DOMWindowOverlay" style="z-index:10000;display:none;position:absolute;top:0;left:0;background-color:'+i.overlayColor+";filter:alpha(opacity="+i.overlayOpacity+");-moz-opacity: 0."+i.overlayOpacity+";opacity: 0."+i.overlayOpacity+';"></div>'),n.isIE6&&(o("body").append('<iframe id="DOMWindowIE6FixIframe"  src="blank.html"  style="width:100%;height:100%;z-index:9999;position:absolute;top:0;left:0;filter:alpha(opacity=0);"></iframe>'),d()),t();var m=o("#DOMWindowOverlay");m.fadeIn("fast");var g=o("#popupClose"),O=o("#popupClose1"),W=o("#popupClose2"),v=o("#popupClose3"),M=o("#popupClose4"),D=o("#popupClose5"),b=o("#popupClose6"),y=o("#popupClose7"),C=o("#popupClose8"),x=o("#popupClose9");i.modal||g.click(function(){o.closeDOMWindow()}),i.modal||O.click(function(){o.closeDOMWindow()}),i.modal||W.click(function(){o.closeDOMWindow(),location.href="/"}),i.modal||v.click(function(){o.closeDOMWindow(),location.href="/"}),i.modal||M.click(function(){o.closeDOMWindow()}),i.modal||D.click(function(){o.closeDOMWindow()}),i.modal||b.click(function(){o.closeDOMWindow()}),i.modal||y.click(function(){o.closeDOMWindow()}),i.modal||C.click(function(){o.closeDOMWindow()}),i.modal||x.click(function(){o.closeDOMWindow()})}i.loader&&""!==i.loaderImagePath&&(o("body").append('<div id="DOMWindowLoader" style="z-index:10002;width:'+i.loaderWidth+"px;height:"+i.loaderHeight+'px;"><img src="'+i.loaderImagePath+'" /></div>'),r()),o("body").append('<div id="DOMWindow" style="background-repeat:no-repeat;text-align:center;'+i.windowBGImage+";overflow:hidden;display:none;height:460px !important;width:1004px !important;background-color:"+i.windowBGColor+';border:4px solid #F2F2F2; position:absolute;z-index:10001"></div>');var S=o("#DOMWindow");switch(i.positionType){case"centered":a(),i.height+50>n.viewPortHeight()&&S.css("top",i.fixedWindowY+n.scrollOffsetHeight()+"px");break;case"absolute":S.css({top:i.positionTop+n.scrollOffsetHeight()+"px",left:i.positionLeft+n.scrollOffsetWidth()+"px"}),o.fn.draggable&&i.draggable&&S.draggable({cursor:"move"});break;case"fixed":l();break;case"anchoredSingleWindow":var w=o(i.anchoredSelector).position(),p=w.left+i.positionLeft,h=w.top+i.positionTop;S.css({top:h+"px",left:p+"px"})}switch(o(window).bind("scroll.DOMWindow",function(){i.overlay&&t(),n.isIE6&&d(),"centered"==i.positionType&&a(),"fixed"==i.positionType&&l()}),o(window).bind("resize.DOMWindow",function(){n.isIE6&&d(),i.overlay&&t(),"centered"==i.positionType&&a()}),i.windowSource){case"inline":S.append(o(i.windowSourceID).children()),S.unload(function(){o(i.windowSourceID).append(S.children())}),c();break;case"iframe":S.append('<iframe frameborder="0" hspace="0" wspace="0" src="'+i.windowSourceURL+'" name="DOMWindowIframe'+Math.round(1e3*Math.random())+'" style="width:100%;height:100%;border:none;background-color:#fff;" id="DOMWindowIframe" ></iframe>'),o("#DOMWindowIframe").load(c());break;case"ajax":"post"==i.windowHTTPType?(-1!==i.windowSourceURL.indexOf("?")?(u=i.windowSourceURL.substr(0,i.windowSourceURL.indexOf("?")),f=s(i.windowSourceURL)):(u=i.windowSourceURL,f={}),S.load(u,f,function(){c()})):(-1==i.windowSourceURL.indexOf("?")&&(i.windowSourceURL+="?"),S.load(i.windowSourceURL+"&random="+(new Date).getTime(),function(){c()}))}}};return i.eventType?this.each(function(e){o(this).bind(i.eventType,function(){return u(this),!1})}):void u()},o.openDOMWindow=function(e){o.fn.openDOMWindow(e)}}(jQuery);
