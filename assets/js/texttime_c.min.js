"use strict";function ChangeDivScroll(){document.getElementById("chatLog");document.getElementById("chatLog").scrollTop=document.getElementById("chatLog").scrollHeight}function menuInit(){$(counselingMenu1).attr("src","/assets/img/of_texttime/menuPartner.png"),$(counselingMenu2).attr("src","/assets/img/of_texttime/menuHistory.png"),$(counselingMenu5).attr("src","/assets/img/of_texttime/menuFaq.png"),$(counselingMenu6).attr("src","/assets/img/of_texttime/menuInfo.png")}function connectSocketio(){"trost.co.kr"===location.host||"www.trost.co.kr"===location.host?socket=io.connect("https://trost.co.kr:8763"):"localhost:8888"===location.host||"www.localhost:8888"===location.host?socket=io.connect("http://localhost:8763"):socket=io.connect("http://"+location.host+":8763"),socket.on("connect",function(){$(".loader").css("display","block"),$(".opacityBg").css("display","block"),socket.emit("enterCounseling","client",clientID,partnerID,counselingNo,"pc")}),0===historyClientNo?($(".b_send").css("display","none"),socket.on("loadMessage",function(t){$(".loader").css("display","none"),$(".opacityBg").css("display","none"),t[0].log=t[0].log.replace(/(\r\n|\n\r|\r|\n)/g,"<br/>"),t[0].log=retImoji(t[0].log),t[1].log=t[1].log.replace(/(\r\n|\n\r|\r|\n)/g,"<br/>"),t[1].log=retImoji(t[1].log),$("#counseling_chat_").append("<tr class='sysMsgAnimation'><td class='chat_log_tc'><table class='chat_log_tc_'><tr><td> <img src='/assets/img/of_texttime/write_loading.gif' style='vertical-align:middle;margin-left:5px;width:33px;'/> </td></tr></table></td></tr>"),setTimeout(function(){$(".sysMsgAnimation").css("display","none"),"trost"===t[0].log_from&&$("#counseling_chat_").append("<tr><td class='chat_log_tc'><table class='chat_log_tc_'><tr><td>"+t[0].log+"</td></tr></table></td></tr>"),$("#counseling_chat_").append("<tr class='sysMsgAnimation'><td class='chat_log_tc'><table class='chat_log_tc_'><tr><td> <img src='/assets/img/of_texttime/write_loading.gif' style='vertical-align:middle;margin-left:5px;width:33px;'/> </td></tr></table></td></tr>"),setTimeout(function(){$(".sysMsgAnimation").css("display","none"),"trost"===t[1].log_from&&$("#counseling_chat_").append("<tr><td class='chat_log_tc'><table class='chat_log_tc_'><tr><td>"+t[1].log+"</td></tr></table></td></tr>")},3e3)},2e3),setTimeout(function(){loadLastMsgNo=t[0].no,$.each(t,function(t,e){var s=e.log;s=e.log.replace(/(\r\n|\n\r|\r|\n)/g,"<br/>"),s=retImoji(s),e.no>2&&("client"===e.log_from?$("#counseling_chat_").append("<tr><td class='chat_log_p'><table class='chat_log_p_'><tr><td style='padding:17px 13px;'>"+s+"</td></tr></table><div id='p_circle'></div><p class='p_p'>"+e.time_message+"</p></td></tr>"):"partner"===e.log_from?$("#counseling_chat_").append("<tr><td class='chat_log_c'><img src='/assets/img/of_partner/"+partnerImg+"_.png' class='p_profile_img'/><span class='p_profile_name'>"+partnerName+"</span><table class='chat_log_c_'><tr><td style='padding:17px 13px;'>"+s+"</td></tr></table><p class='c_p'>"+e.time_message+"</p></td></tr>"):"trost"===e.log_from&&$("#counseling_chat_").append("<tr><td class='chat_log_tc'><table class='chat_log_tc_'><tr><td>"+s+"</td></tr></table></td></tr>")),$(".b_send").css("display","")})},5600)})):socket.on("loadMessage",function(t){$(".loader").css("display","none"),$(".opacityBg").css("display","none"),t.reverse(),$.each(t,function(t,e){var s=e.log;s=e.log.replace(/(\r\n|\n\r|\r|\n)/g,"<br/>"),s=retImoji(s),partnerName=partnerName.replace(" 상담사","<br/>상담사"),"client"===e.log_from?$("#counseling_chat_").prepend("<tr><td class='chat_log_p'><table class='chat_log_p_'><tr><td style='padding:17px 13px;'>"+s+"</td></tr></table><div id='p_circle'></div><p class='p_p'>"+e.time_message+"</p></td></tr>"):"partner"===e.log_from?$("#counseling_chat_").prepend("<tr><td class='chat_log_c'><img src='/assets/img/of_partner/"+partnerImg+"_.png' class='p_profile_img'/><span class='p_profile_name'>"+partnerName+"</span><table class='chat_log_c_'><tr><td style='padding:17px 13px;'>"+s+"</td></tr></table><p class='c_p'>"+e.time_message+"</p></td></tr>"):"trost"===e.log_from&&$("#counseling_chat_").prepend("<tr><td class='chat_log_tc'><table class='chat_log_tc_'><tr><td>"+s+"</td></tr></table></td></tr>"),loadLastMsgNo=e.no,scrollMsgLoad||ChangeDivScroll()})}),socket.on("loadNewMessage",function(t){var e=t.message;e=t.message.replace(/(\r\n|\n\r|\r|\n)/g,"<br/>"),e=retImoji(e),"트로스트"!==t.senderName&&"트로스트"!==t.senderName&&(t.senderName=t.senderName+" 상담사"),"client"===t.senderStatus?$("#counseling_chat_").append("<tr><td class='chat_log_p'><table class='chat_log_p_'><tr><td style='padding:17px 13px;'>"+e+"</td></tr></table><div id='p_circle'></div><p class='p_p'>"+t.time_message+"</p></td></tr>"):"partner"===t.senderStatus?$("#counseling_chat_").append("<tr><td class='chat_log_c'><img src='/assets/img/of_partner/"+t.senderImg+"_.png' class='p_profile_img'/><span class='p_profile_name'>"+t.senderName+"</span><table class='chat_log_c_'><tr><td style='padding:17px 13px;'>"+e+"</td></tr></table><p class='c_p'>"+t.time_message+"</p></td></tr>"):"trost"===t.senderStatus&&$("#counseling_chat_").append("<tr><td class='chat_log_tc'><table class='chat_log_tc_'><tr><td>"+e+"</td></tr></table></td></tr>"),ChangeDivScroll()}),socket.on("messageTyping",function(){$("#typingID").length<1&&($("#counseling_chat_").append("<tr id='typingID'><td class='chat_log_c'><img src='/assets/img/of_partner/"+partnerImg+"_.png' class='p_profile_img'/><span class='p_profile_name'>"+partnerName+"</span><table class='chat_log_c_'><tr><td style='padding:17px 13px;'> 작성 중 <img src='/assets/img/of_texttime/write_loading.gif' style='vertical-align:middle;margin-left:5px;width:33px;'/> </td></tr></table><p class='c_p'></p></td></tr>"),ChangeDivScroll())}),socket.on("messageStopTyping",function(){$("#typingID").remove()})}function retImoji(t){return t=t.split("[감동]").join('<img src="/assets/img/of_emotion/emotion1_.png" class="imoji_sm">'),t=t.split("[화남]").join('<img src="/assets/img/of_emotion/emotion2_.png" class="imoji_sm">'),t=t.split("[공포]").join('<img src="/assets/img/of_emotion/emotion4_.png" class="imoji_sm">'),t=t.split("[고마움]").join('<img src="/assets/img/of_emotion/emotion3_.png" class="imoji_sm">'),t=t.split("[궁금]").join('<img src="/assets/img/of_emotion/emotion5_.png" class="imoji_sm">'),t=t.split("[기쁨]").join('<img src="/assets/img/of_emotion/emotion6_.png" class="imoji_sm">'),t=t.split("[놀람]").join('<img src="/assets/img/of_emotion/emotion7_.png" class="imoji_sm">'),t=t.split("[슬픔]").join('<img src="/assets/img/of_emotion/emotion8_.png" class="imoji_sm">'),t=t.split("[사랑]").join('<img src="/assets/img/of_emotion/emotion9_.png" class="imoji_sm">'),t=t.split("[눈물]").join('<img src="/assets/img/of_emotion/emotion10_.png" class="imoji_sm">'),t=t.split("[안녕]").join('<img src="/assets/img/of_emotion/emotion11_.png" class="imoji_sm">'),t=t.split("[잘자]").join('<img src="/assets/img/of_emotion/emotion12_.png" class="imoji_sm">'),t=t.split("[최고]").join('<img src="/assets/img/of_emotion/emotion13_.png" class="imoji_sm">'),t=t.split("[쿨쿨]").join('<img src="/assets/img/of_emotion/emotion14_.png" class="imoji_sm">')}function emotion_tab_hide(){$("#emotion_box").fadeOut(),$("#emotion_tab").prop("src","/assets/img/of_emotion/emotion_off.png")}function strip_tags(t,e){var e=(((e||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join(""),s=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,o=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return t.replace(o,"").replace(s,function(t,s){return e.indexOf("<"+s.toLowerCase()+">")>-1?t:""})}window.onload=function(){setTimeout("ChangeDivScroll()",1e3)};var counselingMenu1="#counseling_menu_1",counselingMenu2="#counseling_menu_2",counselingMenu5="#counseling_menu_5",counselingMenu6="#counseling_menu_6";$(counselingMenu6).click(function(){menuInit(),$(this).attr("src","/assets/img/of_texttime/menuInfo_.png"),$("#mypage_page6").css("display","block"),$("#mypage_page1, #mypage_page2, #mypage_page4, #mypage_page3, #mypage_page5").css("display","none")}),$(counselingMenu1).click(function(){menuInit(),$(this).attr("src","/assets/img/of_texttime/menuPartner_.png"),$("#mypage_page1").css("display","block"),$("#mypage_page2, #mypage_page3, #mypage_page4, #mypage_page5, #mypage_page6").css("display","none")}),$(counselingMenu2).click(function(){menuInit(),$(this).attr("src","/assets/img/of_texttime/menuHistory_.png"),$("#mypage_page2").css("display","block"),$("#mypage_page1, #mypage_page3, #mypage_page4, #mypage_page5, #mypage_page6").css("display","none")}),$(counselingMenu5).click(function(){menuInit(),$(this).attr("src","/assets/img/of_texttime/menuFaq_.png"),$("#mypage_page5").css("display","block"),$("#mypage_page1, #mypage_page2, #mypage_page4, #mypage_page3, #mypage_page6").css("display","none")}),$(window).on("resize",function(){var t=$("#counseling_profile").width()+.5+"px";$("#counseling_menu").css("left",t)}),$(document).ready(function(){$(counselingMenu6).click();var t=$("#counseling_profile").width()+.5+"px";$("#counseling_menu").css("left",t),$("#mypage_page6").css("display","block"),$("#mypage_page1, #mypage_page2, #mypage_page4, #mypage_page3, #mypage_page5").css("display","none"),$("#emotion_tab").click(function(){"none"===$("#emotion_box").css("display")?($("#emotion_box").fadeIn(),$("#emotion_tab").prop("src","/assets/img/of_emotion/emotion_on.png")):($("#emotion_box").fadeOut(),$("#emotion_tab").prop("src","/assets/img/of_emotion/emotion_off.png"))}),$(".emotion").click(function(){var t=$(this).prop("id");$("#messageSendBox").html($("#messageSendBox").html()+"<img src='/assets/img/of_emotion/"+t+".png' style='height:20px;vertical-align:bottom;'/>")}),$("#emotion_box").css("bottom",$("#messageSendBox").height()+15),$("#emotion_box").css("left",$("#emotion_tab").offset().left-243),$("#messageSendBox").keyup(function(){$("#emotion_box").css("bottom",$("#messageSendBox").height()+15)}),$("#openAddItemCount").click(function(){$(".opacityBg").fadeIn(),$(".addItemCountPopup").fadeIn()}),$("#closeAddTab").click(function(){$(".addItemCount").fadeOut()}),$("#closeAddPopup").click(function(){$(".addItemCountPopup, .opacityBg").fadeOut()}),$("#messageSendBox").bind("paste",function(){var t=$(this);setTimeout(function(){var e=$(t).html();e=strip_tags(e),e=e.replace(/&nbsp;/gi," "),$("#messageSendBox").html(e)},100)}),"Y"!==counselingTerms?($(".counselingAgree").fadeIn(),$(".opacityBg").fadeIn()):connectSocketio(),$(".agreebtn").click(function(){$(".counseling_terms").is(":checked")===!0?$.ajax({url:"/oauth/config/terms/",type:"POST",cache:!1,timeout:3e4,contentType:"application/json; charset=UTF-8",dataType:"json",data:JSON.stringify({type:"counseling",id:clientID}),success:function(t){"Y"==t.result?($(".counselingAgree").fadeOut(),$(".opacityBg").fadeOut(),connectSocketio()):alert(t.msg)}}):alert("동의하신다면 위 체크 박스에 체크 부탁드립니다.")}),$("#sendReview").click(function(){if(!$("#textReview").val())return alert("상담 후기를 작성해주세요."),!1;var t=String("");return $(".writeReview button.selectRecommend.select").attr("id")?("1"==$(".writeReview button.selectRecommend.select").attr("id")?t="Great":"2"==$(".writeReview button.selectRecommend.select").attr("id")?t="Good":"3"==$(".writeReview button.selectRecommend.select").attr("id")&&(t="Bad"),void $.ajax({url:"/oauth/user/review/",type:"POST",cache:!1,timeout:3e4,contentType:"application/json; charset=UTF-8",dataType:"json",data:JSON.stringify({type:"texttime",client:clientID,partner:partnerID,content:$("#textReview").val(),isRecommended:t,device:"WEB",counselingItem:counselingItems}),success:function(t){"Y"==t.result?(alert("성공적으로 리뷰가 등록되었습니다, 감사합니다."),reviewWriteStatus="Y"):alert("리뷰를 작성하지 못했습니다, 다시 시도해주세요")}})):(alert("상담을 평가해주세요."),!1)}),$(".paymentAgain").click(function(){"Y"===reviewWriteStatus?location.href="/service/counseling/":alert("리뷰를 먼저 작성해주세요.")}),$(".afterFinish").click(function(){"Y"===reviewWriteStatus?location.href="/service/counseling/major/chkMajor.php?process=afterFinish&noRoom="+counselingNo+"&partner=cordpartner01":alert("리뷰를 먼저 작성해주세요.")})}),$("#send").click(function(){var t=$("#messageSendBox").html();return""==t?(alert("상담 메세지를 입력해주세요."),!1):(t=t.split('<img src="/assets/img/of_emotion/emotion1.png" style="height:20px;vertical-align:bottom;">').join("[감동]"),t=t.split('<img src="/assets/img/of_emotion/emotion2.png" style="height:20px;vertical-align:bottom;">').join("[화남]"),t=t.split('<img src="/assets/img/of_emotion/emotion4.png" style="height:20px;vertical-align:bottom;">').join("[공포]"),t=t.split('<img src="/assets/img/of_emotion/emotion3.png" style="height:20px;vertical-align:bottom;">').join("[고마움]"),t=t.split('<img src="/assets/img/of_emotion/emotion5.png" style="height:20px;vertical-align:bottom;">').join("[궁금]"),t=t.split('<img src="/assets/img/of_emotion/emotion6.png" style="height:20px;vertical-align:bottom;">').join("[기쁨]"),t=t.split('<img src="/assets/img/of_emotion/emotion7.png" style="height:20px;vertical-align:bottom;">').join("[놀람]"),t=t.split('<img src="/assets/img/of_emotion/emotion8.png" style="height:20px;vertical-align:bottom;">').join("[슬픔]"),t=t.split('<img src="/assets/img/of_emotion/emotion9.png" style="height:20px;vertical-align:bottom;">').join("[사랑]"),t=t.split('<img src="/assets/img/of_emotion/emotion10.png" style="height:20px;vertical-align:bottom;">').join("[눈물]"),t=t.split('<img src="/assets/img/of_emotion/emotion11.png" style="height:20px;vertical-align:bottom;">').join("[안녕]"),t=t.split('<img src="/assets/img/of_emotion/emotion12.png" style="height:20px;vertical-align:bottom;">').join("[잘자]"),t=t.split('<img src="/assets/img/of_emotion/emotion13.png" style="height:20px;vertical-align:bottom;">').join("[최고]"),t=t.split('<img src="/assets/img/of_emotion/emotion14.png" style="height:20px;vertical-align:bottom;">').join("[쿨쿨]"),$("#messageSendBox").html(""),$("#messageSendBox").css("height","65px"),emotion_tab_hide(),t=strip_tags(t,"<br/><br>&nbsp;"),t=t.replace(/<br>/gi,"\n"),t=t.replace(/&nbsp;/gi," "),socket.emit("sendMessage",counselingNo,t,"client","pc"),void(1===statusTyping&&(socket.emit("messageStopTyping"),statusTyping=0)))}),$("#messageSendBox").bind("DOMSubtreeModified",function(){var t=String($("#messageSendBox").html());t.length>=5&&(0===statusTyping&&(socket.emit("messageTyping"),statusTyping=1),1===statusTyping&&setTimeout(function(){(t==$("#messageSendBox").html()||$("#messageSendBox").html().length<5)&&0!==statusTyping&&(socket.emit("messageStopTyping"),statusTyping=0)},2e3))}),$($("#chatLog")).scroll(function(){if(0==msgContent.scrollTop()){if(1===loadLastMsgNo||0===loadLastMsgNo||0===historyClientNo)return!1;socket.emit("loadOldMessage","client",clientID,partnerID,counselingNo,loadLastMsgNo),scrollMsgLoad=1}}),$("#MoreMessage").click(function(){return 1===loadLastMsgNo||0===loadLastMsgNo||0===historyClientNo?!1:(socket.emit("loadOldMessage","client",clientID,partnerID,counselingNo,loadLastMsgNo),void(scrollMsgLoad=1))});
